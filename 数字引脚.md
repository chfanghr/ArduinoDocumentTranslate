# 数字引脚

Arduino上的引脚可以被配置成输入或者输出模式。这个文档介绍了引脚在这两个状态时的功能。尽管该文档的标题指向了数字引脚，要注意到大部分的Arduino（Atmega系列芯片）的模拟引脚，都可以作为数字引脚被配置和使用。

## 当被配置成输入模式（`INPUT`）时引脚的属性

Arduino（Atmega芯片）的引脚会被默认配置成输入模式，因此当你需要将它们作为输入引脚时，它们不需要被明确的使用`pinMode()`定义成输入模式。被以此方式配置的引脚处于**高阻态**。输入引脚对于采样对象的电器属性要求极小，相当于在输入引脚与采样对象之间存在100MOhm左右的电阻。这意味着只要非常小的电流就能够改变输入引脚的状态，这一属性让输入引脚在诸如[实现电容式触摸传感器](http://www.arduino.cc/playground/Code/CapacitiveSensor)、[对光电二极管采样](http://www.arduino.cc/playground/Learning/LEDSensor)、或者[用RCTime之类的方案读取一个模拟传感器上的值](https://www.arduino.cc/en/Tutorial/RCtime)之类的任务上非常实用。

但是这同时也意味着，被配置为`pinMode(pin,INPUT)`但没有连接到任何东西的或者虽然有线连接但没有连接到电路中的引脚，很容易受到环境中电子噪音或与附近引脚的电容耦合效应的影响，会使得引脚状态发生随机的改变，即产生随机的测量结果。

## 被配置为输入模式同时有上拉电阻的引脚

一般情况下使得配置为输入模式但没有输入的引脚有一个已知的状态是非常有必要的。这可以由在引脚与+5V之间加入一个上拉电阻，或者在引脚与地（GND）之间加入一个下拉电阻来实现。一般而言，上拉电阻或下拉电阻可以取阻值10KOhm。

## 被配置成输入上拉模式（`INPUT_PULLUP`）的引脚

在Atmega系列芯片中，有20K的内置上拉电阻，可以从软件配置使用。以`INPUT_PULLUP`作为参数调用`pinMode()`，即可将某个引脚配置为输入模式，并启用该引脚上的内置上拉电阻。这一操作逆转了引脚测量值所代表的意义：当引脚上的电平为高电平时，引脚上的传感器是关闭的，反之是开启的。

该上拉电阻的阻值与所使用的微控制器有关。在大部分使用AVR架构芯片的Arduino上，该值在20-50KOhm之间。在Arduino Due（ARM架构）上，该值在50K-150KOhm之间。如果想知道确切的值，请查询你所使用的微控制器的数据手册。

当你把一个传感器（二端）连接到一个被配置为`INPUT_PULLUP`的引脚上时，传感器的另一端应该连接到地（GND）。比如说一个开关连接在了引脚和地之间，当接通开关时，开关将引脚下拉，使得引脚采样结果是低电平，而当开关断开时，引脚被内置上拉电阻上拉，采样结果是高电平。

内置上拉电阻能为连接在输入模式引脚上的一个LED提供足够的电流使其产生微弱的光亮。如果在项目中有LED看似工作正常但亮度很低，这可能就是原因所在。

控制内置上拉电阻的寄存器（芯片的内存位置）与控制引脚电平高或低的寄存器是同一寄存器。这就导致了，如果有一个处于输入模式并且启用了内置上拉电阻的引脚，当其被配置成输出模式时，该引脚将输出高电平。这反过来也成立。当一个处于高电平的输出引脚被配置成输入模式时，该引脚上的内置上拉电阻将会被自动启用。

如果你的Arduino IDE版本较老（比如说1.0.1），虽然`INPUT_PULLUP`尚未被实现，你仍然可以通过以下方式启用内部上拉电阻：

```c++
pinMode(pin, INPUT); // 将引脚设置成输入模式
digitalWrite(pin, HIGH); // 启用内部上拉电阻
```

> **注意**：在大部分Arduino板子上，第13号引脚相对于其他引脚更难作为数字输入引脚，原因是其上连接了LED和电阻。如果你启用了13号引脚上的20KOhm内置上拉电阻，引脚将保持一个1.7V左右的电平，而不是5V，因为其上连接的LED和电阻将引脚的电平拉低了，这意味着在引脚上采样结果永远是低电平（Arduino的VRef一般都是2.5V，1.7<2.5，为低电平）。如果你一定要使用第13号引脚作为数字输入引脚，请将其设为输入模式（`pinMode(pin, INPUT)`）并且使用一个阻值较小的外部上拉电阻。

## 被配置为输出模式（`OUTPUT`）时的引脚

被`pinMode()`设置为输出模式的引脚呈现出低阻态。这意味着它们可以向电路提较大的电流。Atmega系列芯片的引脚可以向外部负载提供（提供正电流）或吸收（提供负电流）最大为40MA的电流。这个电流的大小足以完全点亮一个LED（别忘了串联限流电阻），或者向许多传感器提供电流，但不足以向大部分继电器、电磁铁、电机提供电流。

短路Arduino的引脚，或者试图用引脚向有较高电流需求的设备提供电流，可能对引脚的输出晶体管造成损害，甚至彻底破坏整个Atmega芯片。大多数情况下这将会使得微控制器上出现“死”引脚，但芯片的剩余部分仍能正常工作。因此，在输出引脚和负载之间串联一个470-1KOhm的电阻是个不错的选择，除非该负载需要引脚提供（吸收）所能提供（吸收）的最大电流。

---

原文档：[Arduino - Digital Pins](https://www.arduino.cc/en/Tutorial/DigitalPins)
